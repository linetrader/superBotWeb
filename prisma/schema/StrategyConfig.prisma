// prisma/schema/StrategyConfig.prisma
model StrategyConfig {
  id               String          @id @default(cuid())
  userId           String
  user             User            @relation(fields: [userId], references: [id], onDelete: Cascade)

  name      String
  kind      StrategyKind

  // 공통(유형과 무관)
  useMartin            Boolean   @default(false)
  martinMultiplier     Float     @default(1.0)
  defaultSize          Int       @default(0)
  maxSize              Int       @default(0)
  targetProfit         Float     @default(0)
  leverage             Int       @default(1)
  timeframe            Timeframe @default(T5m)
  enabled              Boolean   @default(true)
  rsiLength Int        @default(14)

  // ... (기존 공통 필드들)
  trend TrendStrategy?
  box   BoxStrategy?

  // ✅ TradingBot 역방향(1:N) — 필수
  tradingBots TradingBot[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([userId])
  @@unique([userId, name], map: "uniq_user_strategy_name")
}

// prisma/schema/TrendStrategy.prisma
model TrendStrategy {
  id                    String   @id @default(cuid())
  strategyConfigId      String   @unique
  strategyConfig        StrategyConfig @relation(fields: [strategyConfigId], references: [id], onDelete: Cascade)

  // ✅ Trend 전용만 유지
  trendRsiUpperPullback Float?
  trendRsiLowerPullback Float?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// prisma/schema/BoxStrategy.prisma
model BoxStrategy {
  id               String   @id @default(cuid())
  strategyConfigId String   @unique
  strategyConfig   StrategyConfig @relation(fields: [strategyConfigId], references: [id], onDelete: Cascade)

  // ✅ Box 전용
  lowerTh     Float   @default(30)
  upperTh     Float   @default(70)
  boxTouchPct Float?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
